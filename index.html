<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Applab Menu</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <header class="sidebar-header">
        <h1>Applab Hub</h1>
        <p class="subtitle">Play embedded Applab projects</p>
      </header>
      <div id="projectsList" class="projects-list">Loadingâ€¦</div>
      <footer class="sidebar-footer">Add projects to <code>projects.json</code></footer>
    </aside>

    <main class="viewer">
      <div class="viewer-header">
        <h2 id="projTitle">Select a project</h2>
        <div class="viewer-actions">
          <a id="openNewBtn" class="btn" target="_blank" rel="noopener">Open in new tab</a>
        </div>
      </div>

      <div id="viewerWrap" class="viewer-wrap">
        <div id="viewerPlaceholder" class="placeholder">No project selected</div>
        <iframe id="embedFrame" class="embed-frame" src="" title="Applab embed" sandbox="allow-scripts allow-forms allow-same-origin" style="display:none"></iframe>
      </div>

      <div id="projDesc" class="proj-desc"></div>
    </main>
  </div>

  <script>
    async function loadProjects() {
      try {
        const res = await fetch('projects.json');
        const list = await res.json();
        renderList(list);
        if (list.length) selectProject(list[0]);
      } catch (e) {
        document.getElementById('projectsList').textContent = 'Failed to load projects.json';
        console.error(e);
      }
    }

    function renderList(list) {
      const container = document.getElementById('projectsList');
      container.innerHTML = '';
      list.forEach((p, i) => {
        const item = document.createElement('button');
        item.className = 'project-item';
        item.innerHTML = `<div class="item-left"><span class="icon">${p.icon||'ðŸ”—'}</span></div><div class="item-body"><div class="item-title">${p.title}</div><div class="item-sub">${p.tags?p.tags.join(' â€¢ '):''}</div></div>`;
        item.addEventListener('click', () => selectProject(p));
        container.appendChild(item);
      })
    }

    function selectProject(p) {
      const title = document.getElementById('projTitle');
      const desc = document.getElementById('projDesc');
      const iframe = document.getElementById('embedFrame');
      const placeholder = document.getElementById('viewerPlaceholder');
      const openNewBtn = document.getElementById('openNewBtn');

      title.textContent = p.title || 'Untitled';
      desc.textContent = p.description || '';
      openNewBtn.href = p.url || '#';
      openNewBtn.textContent = 'Open in new tab';

      if (p.embedUrl) {
        placeholder.style.display = 'none';
        iframe.style.display = 'block';
        iframe.src = p.embedUrl;
      } else {
        iframe.style.display = 'none';
        iframe.src = '';
        placeholder.style.display = 'flex';
        placeholder.textContent = 'No embed available for this project. Use "Open in new tab".';
      }
    }

    // boot
    loadProjects();
  </script>
</body>
</html>
